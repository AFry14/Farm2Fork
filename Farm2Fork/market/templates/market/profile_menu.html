{% load vendor_tags %}
<div class="profile-menu-container" style="position: relative;">
    <button class="profile-icon-btn" id="profileMenuBtn" onclick="toggleProfileMenu()" style="background: none; border: none; cursor: pointer; padding: 8px; border-radius: 50%; display: flex; align-items: center; justify-content: center; width: 40px; height: 40px; transition: background-color 0.2s;">
        <span style="font-size: 24px;">ðŸ‘¤</span>
    </button>
    <div class="profile-dropdown" id="profileDropdown" style="display: none; position: absolute; top: 100%; right: 0; background-color: white; border: 1px solid #ddd; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); min-width: 200px; z-index: 1000; margin-top: 5px;">
        {% if user.is_authenticated %}
            <div style="padding: 12px 16px; border-bottom: 1px solid #eee; font-weight: bold; color: #2c5530;">
                {{ user.get_full_name|default:user.username }}
            </div>
            <a href="{% url 'edit_profile' %}" style="display: block; padding: 12px 16px; color: #333; text-decoration: none; border-bottom: 1px solid #eee; transition: background-color 0.2s;">
                My Account
            </a>
            {% with user_vendors_list=user|user_vendors %}
                {% if user_vendors_list %}
                    <div style="border-bottom: 1px solid #eee;">
                        <div style="padding: 8px 16px; font-size: 0.85em; color: #666; font-weight: bold; text-transform: uppercase;">Vendor Profiles</div>
                        {% for vendor in user_vendors_list %}
                            <a href="{% url 'vendor_detail' vendor.id %}" style="display: block; padding: 8px 16px 8px 32px; color: #333; text-decoration: none; transition: background-color 0.2s;">
                                {{ vendor.name }}
                            </a>
                        {% endfor %}
                        <a href="{% url 'vendor_dashboard' %}" style="display: block; padding: 8px 16px 8px 32px; color: #2c5530; text-decoration: none; font-weight: bold; transition: background-color 0.2s;">
                            Vendor Dashboard
                        </a>
                    </div>
                {% endif %}
            {% endwith %}
            {% if user.is_staff %}
                <a href="{% url 'admin:index' %}" style="display: block; padding: 12px 16px; color: #6c757d; text-decoration: none; border-top: 1px solid #eee; border-bottom: 1px solid #eee; transition: background-color 0.2s;">
                    Admin Mode
                </a>
            {% endif %}
            <a href="{% url 'logout' %}" onclick="return confirmLogout()" style="display: block; padding: 12px 16px; color: #dc3545; text-decoration: none; transition: background-color 0.2s;">
                Sign Out
            </a>
        {% else %}
            <a href="{% url 'login' %}?next={{ request.path }}" style="display: block; padding: 12px 16px; color: #333; text-decoration: none; transition: background-color 0.2s;">
                Login
            </a>
        {% endif %}
    </div>
</div>

<style>
    .profile-icon-btn:hover {
        background-color: rgba(255,255,255,0.1);
    }
    .profile-dropdown a:hover {
        background-color: #f8f9fa;
    }
</style>

<script>
    function toggleProfileMenu() {
        const dropdown = document.getElementById('profileDropdown');
        if (dropdown.style.display === 'none' || dropdown.style.display === '') {
            dropdown.style.display = 'block';
        } else {
            dropdown.style.display = 'none';
        }
    }
    
    function confirmLogout() {
        return confirm('Are you sure you want to sign out?');
    }
    
    // Close dropdown when clicking outside
    document.addEventListener('click', function(event) {
        const container = document.querySelector('.profile-menu-container');
        const btn = document.getElementById('profileMenuBtn');
        const dropdown = document.getElementById('profileDropdown');
        
        if (container && !container.contains(event.target)) {
            dropdown.style.display = 'none';
        }
    });
</script>

